#!/usr/bin/env bash

# This file was generated by MyCLI/install.rb.
# See MyCLI install instructions for more information.

# Script path: <%= m_filepath %>
# User: <%= full_name %>

export MYCLI_REPO="<%= mycli_repo_path %>"

# !!! Edit this line to make sure you will use the right ruby version
#     This line may be different depending on your environment
export RBENV_VERSION=<%= ruby_version %>

# If the command returns an error we split the string into single letter
# commands and try again. This let's us use `m tcb bob` instead of
# `m t c b bob`.
# !!! WARNING. This retries for ANY failure, not just command not found.
export MYCLI_RETRY_ON_ERROR=<%= retry_on_error %>

# --------------------------------------------------------------------

ruby ${MYCLI_REPO}/m.rb "$@"
retval=$?

if [[ $retval -ne 0 ]] && [[ $MYCLI_RETRY_ON_ERROR -eq 1 ]]; then
  first=$1
  shift
  args=()
  for ((i = 0; i < ${#first}; i++)); do
    args+=("${first:$i:1}")
  done
  args+=("$@")
  echo "Retrying as: m ${args[@]}..."
  ruby ${MYCLI_REPO}/m.rb "${args[@]}"
fi
